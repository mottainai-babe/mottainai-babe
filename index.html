<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>もったいないベビー</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
background:#fafafa;
margin:24px;
}
.card{
max-width:720px;
margin:auto;
background:white;
padding:20px;
border-radius:16px;
border:1px solid #e5e7eb;
}
button{
padding:10px 14px;
border-radius:12px;
border:1px solid #ddd;
cursor:pointer;
}
.primary{
background:#2563eb;
color:white;
border:none;
}
input,textarea{
width:100%;
padding:8px;
margin-top:6px;
margin-bottom:12px;
border-radius:8px;
border:1px solid #ddd;
}
.item{
border:1px solid #eee;
padding:12px;
border-radius:12px;
margin-bottom:12px;
}
pre{
background:#f3f4f6;
padding:12px;
border-radius:12px;
font-size:12px;
}
</style>
</head>

<body>
<div class="card">

<h1>もったいないベビー</h1>
<p>大阪エリア限定｜ベビー用品ゆずりあいサービス</p>

<button id="btnLogin" class="primary">Googleでログイン</button>
<button id="btnLogout">ログアウト</button>

<hr>

<h3>物品を登録</h3>

<input id="title" placeholder="例：ベビーカー">
<textarea id="description" placeholder="状態・使用期間など"></textarea>
<button id="btnAdd" class="primary">登録する</button>

<hr>

<h3>出品一覧</h3>
<div id="itemList"></div>

<h3>システムログ</h3>
<pre id="log"></pre>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth,GoogleAuthProvider,signInWithPopup,signOut,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore,collection,addDoc,serverTimestamp,onSnapshot,query,orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyAEk6aDtbuXU9K2bUnygYBqHMh75MeOlFU",
authDomain:"mottainai-babe.firebaseapp.com",
projectId:"mottainai-babe",
storageBucket:"mottainai-babe.firebasestorage.app",
messagingSenderId:"752649559489",
appId:"1:752649559489:web:1288d8adeef7280eb7a340"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

const log=(m)=>{document.getElementById("log").textContent=m+"\n"+document.getElementById("log").textContent;}

let currentUser=null;

document.getElementById("btnLogin").onclick=async()=>{
await signInWithPopup(auth,provider);
};

document.getElementById("btnLogout").onclick=async()=>{
await signOut(auth);
log("ログアウトしました");
};

onAuthStateChanged(auth,(user)=>{
if(user){
currentUser=user;
log("ログイン成功："+user.email);
}else{
currentUser=null;
}
});

document.getElementById("btnAdd").onclick=async()=>{
if(!currentUser){alert("ログインしてください");return;}
const title=document.getElementById("title").value;
const description=document.getElementById("description").value;
if(!title){alert("タイトル必須");return;}

await addDoc(collection(db,"items"),{
title,
description,
ownerName:currentUser.displayName,
ownerEmail:currentUser.email,
createdAt:serverTimestamp()
});

document.getElementById("title").value="";
document.getElementById("description").value="";
log("登録完了");
};

const q=query(collection(db,"items"),orderBy("createdAt","desc"));

onSnapshot(q,(snapshot)=>{
const list=document.getElementById("itemList");
list.innerHTML="";
snapshot.forEach(doc=>{
const data=doc.data();
const div=document.createElement("div");
div.className="item";
div.innerHTML=`
<b>${data.title}</b><br>
${data.description||""}<br><br>
<button onclick="contact('${data.ownerEmail}','${data.title}')">問い合わせ</button>
`;
list.appendChild(div);
});
});

window.contact=(email,title)=>{
const message=`こんにちは。\n「${title}」についてお問い合わせします。\nまだ募集していますか？`;
navigator.clipboard.writeText(message);
alert("問い合わせ文をコピーしました。\nメールやLINEで送ってください。");
};
</script>

</body>
</html>
